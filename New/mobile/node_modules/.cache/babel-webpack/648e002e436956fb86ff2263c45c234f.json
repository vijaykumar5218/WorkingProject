{"ast":null,"code":"import * as HighCharts from 'highcharts';\nimport { Subscription } from 'rxjs';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@shared-lib/services/journey/journey.service\";\nexport let PieChartComponent = /*#__PURE__*/(() => {\n  class PieChartComponent {\n    constructor(journeyService) {\n      this.journeyService = journeyService;\n      this.subscription = new Subscription();\n      this.highCharts = HighCharts;\n      this.colors = [];\n    }\n\n    ngOnInit() {\n      const currentJourney = this.journeyService.getCurrentJourney();\n\n      if (this.journeyService.journeyServiceMap[currentJourney.journeyID]) {\n        this.subscription.add(this.journeyService.journeyServiceMap[currentJourney.journeyID].valueChange.subscribe(() => {\n          this.doPieCalculations(this.journeyService.journeyServiceMap[currentJourney.journeyID]);\n        }));\n      }\n    }\n\n    doPieCalculations(service) {\n      this.colors = [];\n      const chartData = [];\n      this.element.elements.forEach(item => {\n        this.colors.push(item.color);\n        const value = service[item.answerId];\n        chartData.push({\n          name: item.label,\n          y: Math.round(value)\n        });\n      });\n      this.setLabelAndDistance(chartData);\n      this.pushDataToPieChart(chartData);\n    }\n\n    setLabelAndDistance(chartData) {\n      const total = chartData.reduce((a, b) => {\n        return a + b.y;\n      }, 0);\n      chartData.forEach(el => {\n        const percentage = this.percentage(el.y, total);\n        el.label = percentage === 0 ? '' : Math.round(percentage) + '%';\n        el.dataLabels = {\n          distance: this.setDistance(percentage)\n        };\n      });\n    }\n\n    setDistance(value) {\n      if (0 < value && value < 25) {\n        return -15;\n      } else if (26 < value && value < 50) {\n        return -50;\n      } else {\n        return -75;\n      }\n    }\n\n    pushDataToPieChart(chartData) {\n      this.highCharts.setOptions({\n        lang: {\n          thousandsSep: ','\n        }\n      });\n      this.highCharts.chart('container', {\n        credits: {\n          enabled: false\n        },\n        chart: {\n          width: window.innerWidth - 77,\n          height: 300\n        },\n        title: {\n          text: undefined\n        },\n        plotOptions: {\n          pie: {\n            size: '80%',\n            events: {\n              click: function (e) {\n                e.preventDefault();\n              }\n            },\n            allowPointSelect: true,\n            tooltip: {\n              headerFormat: undefined,\n              pointFormat: '<b>{point.name} : ${point.y:,.0f}</b>'\n            },\n            dataLabels: {\n              format: '<b>{point.label}</b>',\n              useHTML: true,\n              style: {\n                fontWeight: 'bold',\n                color: 'white',\n                textDecoration: 'none',\n                fontSize: '14px'\n              }\n            },\n            startAngle: 0,\n            endAngle: 0,\n            center: ['50%', '50%'],\n            colors: this.colors\n          }\n        },\n        series: [{\n          type: 'pie',\n          data: chartData\n        }]\n      });\n    }\n\n    percentage(item, total) {\n      const percent = item / total * 100;\n      return percent <= this.element.minValue ? 0 : percent;\n    }\n\n    ngOnDestroy() {\n      this.subscription.unsubscribe();\n    }\n\n  }\n\n  PieChartComponent.ɵfac = function PieChartComponent_Factory(t) {\n    return new (t || PieChartComponent)(i0.ɵɵdirectiveInject(i1.JourneyService));\n  };\n\n  PieChartComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: PieChartComponent,\n    selectors: [[\"journey-step-charts-pie-chart\"]],\n    inputs: {\n      element: \"element\"\n    },\n    decls: 1,\n    vars: 0,\n    consts: [[\"id\", \"container\"]],\n    template: function PieChartComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelement(0, \"div\", 0);\n      }\n    },\n    encapsulation: 2\n  });\n  return PieChartComponent;\n})();","map":null,"metadata":{},"sourceType":"module"}