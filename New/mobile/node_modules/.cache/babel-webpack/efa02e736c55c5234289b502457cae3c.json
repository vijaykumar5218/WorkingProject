{"ast":null,"code":"import { __awaiter } from \"tslib\";\nimport { EventEmitter } from '@angular/core';\nimport * as pageContent from './constants/content.json';\nimport { card, upload_from } from '@shared-lib/components/coverages/plan-tabs/plan-details/my-id-card/constants/camera.enum';\nimport { Camera, CameraResultType, CameraSource } from '@capacitor/camera';\nimport { CardModalComponent } from '../../my-id-card/card-modal/card-modal.component';\nimport PhotoCropping from 'mobile/customPlugins/photoCroppingPlugin';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@shared-lib/services/benefits/benefits.service\";\nimport * as i2 from \"@shared-lib/services/utility/utility.service\";\nimport * as i3 from \"@ionic/angular\";\nimport * as i4 from \"@angular/common\";\nconst _c0 = [\"fileInput\"];\n\nfunction CardComponent_div_0_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r5 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"div\", 2);\n    i0.ɵɵelementStart(1, \"div\", 3);\n    i0.ɵɵtext(2);\n    i0.ɵɵelementStart(3, \"span\", 4);\n    i0.ɵɵtext(4);\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(5);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"div\", 5);\n    i0.ɵɵtext(7);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(8, \"div\", 6);\n    i0.ɵɵelement(9, \"img\", 7);\n    i0.ɵɵelementStart(10, \"div\", 8);\n    i0.ɵɵelementStart(11, \"span\", 9);\n    i0.ɵɵlistener(\"keydown.enter\", function CardComponent_div_0_Template_span_keydown_enter_11_listener() {\n      i0.ɵɵrestoreView(_r5);\n      const ctx_r4 = i0.ɵɵnextContext();\n      return ctx_r4.openFileBrowser();\n    })(\"click\", function CardComponent_div_0_Template_span_click_11_listener() {\n      i0.ɵɵrestoreView(_r5);\n      const ctx_r6 = i0.ɵɵnextContext();\n      return ctx_r6.openFileBrowser();\n    });\n    i0.ɵɵelementStart(12, \"span\", 10);\n    i0.ɵɵtext(13);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(14, \"input\", 11, 12);\n    i0.ɵɵlistener(\"change\", function CardComponent_div_0_Template_input_change_14_listener($event) {\n      i0.ɵɵrestoreView(_r5);\n      const ctx_r7 = i0.ɵɵnextContext();\n      return ctx_r7.selectFile($event);\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(16);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵproperty(\"ngClass\", ctx_r0.side === ctx_r0.cardSide.BACK ? \"align-right\" : \"\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r0.pageContent.cardSection.header.upload, \"\\u00A0\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r0.side === ctx_r0.cardSide.FRONT ? ctx_r0.pageContent.cardSection.header.frontSide : ctx_r0.pageContent.cardSection.header.backSide, \"\\u00A0 \");\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\"\", ctx_r0.pageContent.common.card, \" \");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(ctx_r0.pageContent.cardSection.subHeader);\n    i0.ɵɵadvance(6);\n    i0.ɵɵtextInterpolate(ctx_r0.isWeb ? ctx_r0.pageContent.cardSection.browse.browse : ctx_r0.pageContent.cardSection.browse.click);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r0.isWeb ? ctx_r0.pageContent.cardSection.browse.choose : ctx_r0.pageContent.cardSection.browse.add, \" \");\n  }\n}\n\nfunction CardComponent_ng_template_1_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r10 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"div\", 2);\n    i0.ɵɵelementStart(1, \"div\", 3);\n    i0.ɵɵelementStart(2, \"span\", 4);\n    i0.ɵɵtext(3);\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(4);\n    i0.ɵɵelementStart(5, \"span\", 13);\n    i0.ɵɵlistener(\"keydown.enter\", function CardComponent_ng_template_1_Template_span_keydown_enter_5_listener() {\n      i0.ɵɵrestoreView(_r10);\n      const ctx_r9 = i0.ɵɵnextContext();\n      return ctx_r9.changeCard();\n    })(\"click\", function CardComponent_ng_template_1_Template_span_click_5_listener() {\n      i0.ɵɵrestoreView(_r10);\n      const ctx_r11 = i0.ɵɵnextContext();\n      return ctx_r11.changeCard();\n    });\n    i0.ɵɵtext(6);\n    i0.ɵɵelementStart(7, \"input\", 11, 12);\n    i0.ɵɵlistener(\"change\", function CardComponent_ng_template_1_Template_input_change_7_listener($event) {\n      i0.ɵɵrestoreView(_r10);\n      const ctx_r12 = i0.ɵɵnextContext();\n      return ctx_r12.selectFile($event);\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(9, \"div\", 14);\n    i0.ɵɵelement(10, \"img\", 15);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r2 = i0.ɵɵnextContext();\n    i0.ɵɵproperty(\"ngClass\", ctx_r2.side === ctx_r2.cardSide.BACK ? \"align-right\" : \"\");\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r2.side === ctx_r2.cardSide.FRONT ? ctx_r2.pageContent.card.header.frontSide : ctx_r2.pageContent.card.header.backSide, \"\\u00A0 \");\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\"\", ctx_r2.pageContent.common.card, \" \");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\"\", ctx_r2.pageContent.card.header.change, \" \");\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"src\", ctx_r2.imgUrl, i0.ɵɵsanitizeUrl)(\"alt\", ctx_r2.side === ctx_r2.cardSide.FRONT ? \"Front side of your card\" : \"Back side of your card\");\n  }\n}\n\nexport let CardComponent = /*#__PURE__*/(() => {\n  class CardComponent {\n    constructor(benefit, utilService, actionSheetCtrl, modalController, platform) {\n      this.benefit = benefit;\n      this.utilService = utilService;\n      this.actionSheetCtrl = actionSheetCtrl;\n      this.modalController = modalController;\n      this.platform = platform;\n      this.pageContent = pageContent;\n      this.fileBase64 = new EventEmitter();\n      this.cardSide = card;\n      this.camera = Camera;\n      this.photoCropping = PhotoCropping;\n    }\n\n    ngOnInit() {\n      this.isWeb = this.utilService.getIsWeb();\n    }\n\n    ngAfterViewInit() {\n      this.imgUrl = this.imageBase64 ? this.benefit.appendBase64MetaData(this.imageBase64) : undefined;\n    }\n\n    openFileBrowser() {\n      if (this.isWeb) {\n        this.fileInput.nativeElement.click();\n      } else {\n        this.presentActionSheet();\n      }\n    }\n\n    selectFile(event) {\n      const file = event.target.files[0];\n      const reader = new FileReader();\n      reader.readAsDataURL(file);\n\n      reader.onload = () => {\n        const imageData = reader.result;\n        this.imgUrl = imageData;\n        const base64Image = this.benefit.trimBase64MetaData(imageData);\n        this.fileBase64.emit(base64Image);\n      };\n    }\n\n    changeCard() {\n      this.openFileBrowser();\n    }\n\n    presentActionSheet() {\n      return __awaiter(this, void 0, void 0, function* () {\n        const actionSheet = yield this.actionSheetCtrl.create({\n          buttons: [{\n            text: this.pageContent.actionsheet.fromPhotos,\n            handler: () => {\n              this.startLoader(upload_from.PHOTOS);\n            }\n          }, {\n            text: this.pageContent.actionsheet.fromCamera,\n            handler: () => {\n              this.startLoader(upload_from.CAMERA);\n            }\n          }, {\n            text: this.pageContent.actionsheet.cancel,\n            role: 'cancel'\n          }]\n        });\n        yield actionSheet.present();\n      });\n    }\n\n    startLoader(type) {\n      return __awaiter(this, void 0, void 0, function* () {\n        const permission = yield this.checkPermissionAndRequest(type);\n\n        if (permission) {\n          this.load(type);\n        }\n      });\n    }\n\n    load(type) {\n      return __awaiter(this, void 0, void 0, function* () {\n        const image = yield this.openSource(type);\n\n        if (image) {\n          let img = image.base64String;\n\n          if (this.platform.is('ios') && type === upload_from.CAMERA) {\n            img = (yield this.photoCropping.cropPhoto({\n              image: img\n            })).image;\n          }\n\n          this.imgUrl = 'data:image/jpeg;base64,' + img;\n          this.fileBase64.emit(img);\n        }\n      });\n    }\n\n    openSource(type) {\n      return __awaiter(this, void 0, void 0, function* () {\n        try {\n          const image = yield this.camera.getPhoto({\n            quality: 90,\n            allowEditing: !this.platform.is('ios'),\n            source: type === upload_from.CAMERA ? CameraSource.Camera : CameraSource.Photos,\n            resultType: CameraResultType.Base64\n          });\n          return image;\n        } catch (error) {\n          return undefined;\n        }\n      });\n    }\n\n    checkPermissionAndRequest(type) {\n      return __awaiter(this, void 0, void 0, function* () {\n        const permission = yield this.camera.checkPermissions();\n        const permissionType = type === upload_from.CAMERA ? 'camera' : 'photos';\n        let result = yield this.checkPermission(permission, type);\n\n        if (!result && permission[permissionType] !== 'denied') {\n          const requestPermission = yield this.camera.requestPermissions({\n            permissions: [permissionType]\n          });\n          result = yield this.checkPermission(requestPermission, type);\n        }\n\n        return result;\n      });\n    }\n\n    checkPermission(permission, type) {\n      return __awaiter(this, void 0, void 0, function* () {\n        let result = false;\n\n        if (permission[type] === 'granted' || permission[type] === 'limited') {\n          result = true;\n        } else if (permission[type] === 'denied') {\n          const header = (type === 'camera' ? 'Camera' : 'Photo library') + ' permission is denied';\n          const description = 'Please enable ' + (type === 'camera' ? 'camera' : 'photo library') + ' permission from the device settings of the app to use this feature.';\n          this.showModal({\n            yesText: 'Okay',\n            description: description,\n            header: header\n          });\n        }\n\n        return result;\n      });\n    }\n\n    showModal(componentProps) {\n      return __awaiter(this, void 0, void 0, function* () {\n        const modal = yield this.modalController.create({\n          component: CardModalComponent,\n          cssClass: 'modal-not-fullscreen',\n          swipeToClose: false,\n          componentProps: componentProps\n        });\n        modal.present();\n      });\n    }\n\n  }\n\n  CardComponent.ɵfac = function CardComponent_Factory(t) {\n    return new (t || CardComponent)(i0.ɵɵdirectiveInject(i1.BenefitsService), i0.ɵɵdirectiveInject(i2.SharedUtilityService), i0.ɵɵdirectiveInject(i3.ActionSheetController), i0.ɵɵdirectiveInject(i3.ModalController), i0.ɵɵdirectiveInject(i3.Platform));\n  };\n\n  CardComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: CardComponent,\n    selectors: [[\"card-component\"]],\n    viewQuery: function CardComponent_Query(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵviewQuery(_c0, 5);\n      }\n\n      if (rf & 2) {\n        let _t;\n\n        i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.fileInput = _t.first);\n      }\n    },\n    inputs: {\n      side: \"side\",\n      imageBase64: \"imageBase64\"\n    },\n    outputs: {\n      fileBase64: \"fileBase64\"\n    },\n    decls: 3,\n    vars: 2,\n    consts: [[\"class\", \"card-section\", 3, \"ngClass\", 4, \"ngIf\", \"ngIfElse\"], [\"showCard\", \"\"], [1, \"card-section\", 3, \"ngClass\"], [1, \"header\"], [1, \"card-side\"], [1, \"sub-header\"], [1, \"image-placeholder\"], [\"src\", \"assets/icon/image-placeholder.svg\", \"alt\", \"\", 1, \"placeholder\"], [1, \"browse-text\"], [\"tabindex\", \"0\", \"automation-id\", \"open-file-browser\", 3, \"keydown.enter\", \"click\"], [1, \"browse-title\"], [\"type\", \"file\", \"accept\", \"image/png, image/jpeg, image/tiff\", 1, \"input\", 3, \"change\"], [\"fileInput\", \"\"], [\"tabindex\", \"0\", \"automation-id\", \"change-card\", 1, \"change\", 3, \"keydown.enter\", \"click\"], [1, \"card-image\"], [3, \"src\", \"alt\"]],\n    template: function CardComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵtemplate(0, CardComponent_div_0_Template, 17, 7, \"div\", 0);\n        i0.ɵɵtemplate(1, CardComponent_ng_template_1_Template, 11, 6, \"ng-template\", null, 1, i0.ɵɵtemplateRefExtractor);\n      }\n\n      if (rf & 2) {\n        const _r1 = i0.ɵɵreference(2);\n\n        i0.ɵɵproperty(\"ngIf\", ctx.imgUrl === undefined)(\"ngIfElse\", _r1);\n      }\n    },\n    directives: [i4.NgIf, i4.NgClass],\n    styles: [\".card-section[_ngcontent-%COMP%]{width:95%;height:275px;background-color:var(--white);display:flex;flex-direction:column;align-items:center;padding:30px 40px 40px;grid-gap:20px;gap:20px;border-radius:12px}.card-section[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]{height:16px;font-weight:700;font-size:16px;line-height:16px;display:flex;align-items:center;text-align:center;letter-spacing:.0015em;color:var(--primary-colors-voya-black);white-space:nowrap}.card-section[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .card-side[_ngcontent-%COMP%]{color:var(--v-colors__voya-dark-orange)}.card-section[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .change[_ngcontent-%COMP%]{font-size:12px;text-decoration:underline;text-align:right;margin-left:20px;color:var(--primary-colors-voya-dark-blue);cursor:pointer}.card-section[_ngcontent-%COMP%]   .card-image[_ngcontent-%COMP%]{box-sizing:border-box;display:flex;justify-content:center;align-items:center;grid-gap:4px;gap:4px;width:100%;height:170px;background:var(--ion-color-white);border:1px solid var(--secondary-colors-medium-gray-3);border-radius:8px;flex:none;order:1;flex-grow:0}.card-section[_ngcontent-%COMP%]   .card-image[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{max-height:90%;max-width:90%}.card-section[_ngcontent-%COMP%]   .input[_ngcontent-%COMP%]{display:none}.card-section[_ngcontent-%COMP%]   .sub-header[_ngcontent-%COMP%]{width:166px;height:15px;font-weight:400;font-size:12px;line-height:15px;display:flex;align-items:center;text-align:center;letter-spacing:.004em;color:var(--voya-grey-font);flex:none;order:1;flex-grow:0}.card-section[_ngcontent-%COMP%]   .image-placeholder[_ngcontent-%COMP%]{box-sizing:border-box;display:flex;flex-direction:column;align-items:center;grid-gap:20px;gap:20px;width:100%;height:132px;background:var(--ion-color-primary-contrast);border:1px dashed var(--voya-grey-font);border-radius:4px;flex:none;order:1;flex-grow:0}.card-section[_ngcontent-%COMP%]   .image-placeholder[_ngcontent-%COMP%]   .placeholder[_ngcontent-%COMP%]{padding-top:24px}.card-section[_ngcontent-%COMP%]   .image-placeholder[_ngcontent-%COMP%]   .browse-text[_ngcontent-%COMP%]{height:20px;font-weight:400;font-size:16px;line-height:20px;letter-spacing:.005em;flex:none;order:0;flex-grow:0}.card-section[_ngcontent-%COMP%]   .image-placeholder[_ngcontent-%COMP%]   .browse-text[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:var(--v-colors__primary)}.card-section[_ngcontent-%COMP%]   .image-placeholder[_ngcontent-%COMP%]   .browse-text[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]   .browse-title[_ngcontent-%COMP%]{text-decoration:underline;cursor:pointer}@media screen and (min-width: 768px){.align-right[_ngcontent-%COMP%]{float:right}}@media screen and (max-width: 767px){.card-section[_ngcontent-%COMP%]{margin:auto}}\"]\n  });\n  return CardComponent;\n})();","map":null,"metadata":{},"sourceType":"module"}