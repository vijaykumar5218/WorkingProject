{"ast":null,"code":"import { __awaiter } from \"tslib\";\nimport { BrowserVault, Device, Vault, VaultType } from '@ionic-enterprise/identity-vault';\nimport { Capacitor } from '@capacitor/core';\nimport { biometricsVaultConfig, defaultVaultConfig } from './contants/authConstants';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/router\";\nexport const VAULT_CONFIG_KEY = 'vault_config';\nexport const DEFAULT_FACEID_DISABLED = 'default_faceid_disabled_flag';\nexport let VaultService = /*#__PURE__*/(() => {\n  class VaultService {\n    constructor(router, ngZone) {\n      this.router = router;\n      this.ngZone = ngZone;\n    }\n\n    initializeVault() {\n      return __awaiter(this, void 0, void 0, function* () {\n        let vaultConfig = JSON.parse(localStorage.getItem(VAULT_CONFIG_KEY));\n\n        if (!vaultConfig) {\n          vaultConfig = defaultVaultConfig;\n        }\n\n        this.vault = Capacitor.isNativePlatform() ? new Vault(vaultConfig) : new BrowserVault(vaultConfig);\n        this.vault.onError(this.onVaultError.bind(this));\n      });\n    }\n\n    onVaultError(error) {\n      return __awaiter(this, void 0, void 0, function* () {\n        if (error.code == 8 || error.code == 13) {\n          this.ngZone.run(() => {\n            this.router.navigateByUrl('landing');\n          });\n        }\n      });\n    }\n\n    isFaceIDAvailableOnDevice() {\n      return __awaiter(this, void 0, void 0, function* () {\n        const isBiometricSupport = yield Device.isBiometricsSupported();\n        const isBiometricEnabled = yield Device.isBiometricsEnabled();\n\n        if (isBiometricSupport && isBiometricEnabled) {\n          return true;\n        } else {\n          return false;\n        }\n      });\n    }\n\n    setDefaultFaceIDDisabled(flag) {\n      localStorage.setItem(DEFAULT_FACEID_DISABLED, flag.toString());\n    }\n\n    defaultFaceIDDisabled() {\n      return localStorage.getItem(DEFAULT_FACEID_DISABLED) === 'true';\n    }\n\n    enableFaceID() {\n      return __awaiter(this, void 0, void 0, function* () {\n        if (yield this.isFaceIDAvailableOnDevice()) {\n          yield this.vault.updateConfig(biometricsVaultConfig);\n          localStorage.setItem(VAULT_CONFIG_KEY, JSON.stringify(biometricsVaultConfig));\n          return true;\n        }\n\n        return false;\n      });\n    }\n\n    disableFaceID() {\n      return __awaiter(this, void 0, void 0, function* () {\n        yield this.vault.updateConfig(defaultVaultConfig);\n        localStorage.setItem(VAULT_CONFIG_KEY, JSON.stringify(defaultVaultConfig));\n      });\n    }\n\n    clearVault() {\n      return __awaiter(this, void 0, void 0, function* () {\n        yield this.vault.clear();\n      });\n    }\n\n    isFaceIDEnabled() {\n      const vaultConfig = JSON.parse(localStorage.getItem(VAULT_CONFIG_KEY));\n\n      if (!vaultConfig) {\n        return false;\n      }\n\n      return vaultConfig.type === VaultType.DeviceSecurity;\n    }\n\n    isLocked() {\n      return this.vault.isLocked();\n    }\n\n    lockVault() {\n      return __awaiter(this, void 0, void 0, function* () {\n        yield this.vault.lock();\n      });\n    }\n\n    unlockVault() {\n      return __awaiter(this, void 0, void 0, function* () {\n        yield this.vault.unlock();\n      });\n    }\n\n    hasStoredSession() {\n      return this.vault.doesVaultExist();\n    }\n\n  }\n\n  VaultService.ɵfac = function VaultService_Factory(t) {\n    return new (t || VaultService)(i0.ɵɵinject(i1.Router), i0.ɵɵinject(i0.NgZone));\n  };\n\n  VaultService.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n    token: VaultService,\n    factory: VaultService.ɵfac,\n    providedIn: 'root'\n  });\n  return VaultService;\n})();","map":null,"metadata":{},"sourceType":"module"}