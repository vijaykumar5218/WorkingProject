{"ast":null,"code":"import _asyncToGenerator from \"/Users/vijay.a/Documents/GitHub/MYVOYAGE/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport { HttpParams } from '@angular/common/http';\nimport { Subject } from 'rxjs';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@ionic-native/http/ngx\";\nimport * as i2 from \"@angular/router\";\nimport * as i3 from \"../loading-service/loading.service\";\nimport * as i4 from \"@angular/common\";\nimport * as i5 from \"../authentication/authentication.service\";\nexport let MobileBaseService = /*#__PURE__*/(() => {\n  class MobileBaseService {\n    constructor(http, router, loadingService, location, authService) {\n      this.http = http;\n      this.router = router;\n      this.loadingService = loadingService;\n      this.location = location;\n      this.authService = authService;\n      this.webServiceError = new Subject();\n      this.isBusy = false;\n      this.http.setDataSerializer('json');\n    }\n\n    errorEvents() {\n      return this.webServiceError.asObservable();\n    }\n\n    setDataSerializer(serializer) {\n      this.http.setDataSerializer(serializer);\n    }\n\n    awaitIsBusy() {\n      var _this = this;\n\n      const poll = /*#__PURE__*/function () {\n        var _ref = _asyncToGenerator(function* (resolve) {\n          if (!_this.isBusy) {\n            resolve();\n          } else {\n            setTimeout(() => {\n              poll(resolve);\n            }, 50);\n          }\n        });\n\n        return function poll(_x) {\n          return _ref.apply(this, arguments);\n        };\n      }();\n\n      return new Promise(poll);\n    }\n\n    buildHeaders() {\n      var _this2 = this;\n\n      return _asyncToGenerator(function* () {\n        if (_this2.isBusy) {\n          yield _this2.awaitIsBusy();\n        }\n\n        _this2.isBusy = true;\n        let token = '';\n\n        try {\n          const isAuth = yield _this2.authService.isAuthenticated();\n\n          if (isAuth) {\n            token = yield _this2.authService.getAccessToken();\n          } else {\n            _this2.authService.logout();\n          }\n        } finally {\n          _this2.isBusy = false;\n        }\n\n        return {\n          Authorization: 'Bearer ' + token,\n          'X-Requested-By': 'myvoyageui'\n        };\n      })();\n    }\n\n    post(url, request, httpHeader) {\n      var _this3 = this;\n\n      return _asyncToGenerator(function* () {\n        let headers;\n\n        if (httpHeader) {\n          headers = httpHeader;\n        } else {\n          headers = yield _this3.buildHeaders();\n        }\n\n        try {\n          const result = yield _this3.http.post(url, request, headers);\n\n          if (result.data) {\n            return JSON.parse(result.data);\n          } else {\n            return null;\n          }\n        } catch (ex) {\n          _this3.webServiceError.next();\n\n          console.log(ex);\n          return null;\n        }\n      })();\n    }\n\n    postWithoutResponse(url, request) {\n      var _this4 = this;\n\n      return _asyncToGenerator(function* () {\n        const headers = yield _this4.buildHeaders();\n\n        _this4.http.post(url, request, headers);\n      })();\n    }\n\n    put(url, request) {\n      var _this5 = this;\n\n      return _asyncToGenerator(function* () {\n        const headers = yield _this5.buildHeaders();\n\n        try {\n          const result = yield _this5.http.put(url, request, headers);\n\n          if (result.data) {\n            return JSON.parse(result.data);\n          } else {\n            return null;\n          }\n        } catch (ex) {\n          console.log(ex);\n\n          _this5.webServiceError.next();\n\n          return null;\n        }\n      })();\n    }\n\n    get(url, useAuth = true) {\n      var _this6 = this;\n\n      return _asyncToGenerator(function* () {\n        let headers = {};\n\n        if (useAuth) {\n          headers = yield _this6.buildHeaders();\n        }\n\n        try {\n          const result = yield _this6.http.get(url, {}, headers);\n\n          if (result.data) {\n            return JSON.parse(result.data);\n          } else {\n            console.log(result);\n            return null;\n          }\n        } catch (ex) {\n          console.log(ex);\n\n          _this6.webServiceError.next();\n\n          return null;\n        }\n      })();\n    }\n\n    getWithoutResponse(url) {\n      var _this7 = this;\n\n      return _asyncToGenerator(function* () {\n        const headers = yield _this7.buildHeaders();\n        return _this7.http.get(url, {}, headers);\n      })();\n    }\n\n    clearCookies() {\n      this.http.clearCookies();\n    }\n\n    getCookieString(domain) {\n      return this.http.getCookieString(domain);\n    }\n\n    navigateByUrl(url) {\n      this.router.navigateByUrl(url);\n    }\n\n    navigateBack() {\n      this.location.back();\n    }\n\n    startLoading(startLoading) {\n      if (startLoading) {\n        this.loadingService.startLoading();\n      }\n    }\n\n    stopLoading(stopLoading) {\n      if (stopLoading) {\n        this.loadingService.stopLoading();\n      }\n    }\n\n    postUrlEncoded(url, request, httpHeader) {\n      var _this8 = this;\n\n      return _asyncToGenerator(function* () {\n        let headers;\n\n        if (httpHeader) {\n          headers = httpHeader;\n        } else {\n          headers = yield _this8.buildHeaders();\n        }\n\n        headers['Content-Type'] = 'application/x-www-form-urlencoded';\n        const params = new HttpParams({\n          fromObject: request\n        });\n\n        _this8.setDataSerializer('utf8');\n\n        let returnVal = null;\n\n        try {\n          const result = yield _this8.http.post(url, params.toString(), headers);\n          returnVal = JSON.parse(result.data);\n        } catch (ex) {\n          console.log(ex);\n        }\n\n        _this8.setDataSerializer('json');\n\n        return returnVal;\n      })();\n    }\n\n  }\n\n  MobileBaseService.ɵfac = function MobileBaseService_Factory(t) {\n    return new (t || MobileBaseService)(i0.ɵɵinject(i1.HTTP), i0.ɵɵinject(i2.Router), i0.ɵɵinject(i3.LoadingService), i0.ɵɵinject(i4.Location), i0.ɵɵinject(i5.AuthenticationService));\n  };\n\n  MobileBaseService.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n    token: MobileBaseService,\n    factory: MobileBaseService.ɵfac,\n    providedIn: 'root'\n  });\n  return MobileBaseService;\n})();","map":null,"metadata":{},"sourceType":"module"}