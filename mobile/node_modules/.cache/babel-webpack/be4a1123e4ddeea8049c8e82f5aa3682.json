{"ast":null,"code":"import { __awaiter } from \"tslib\";\nimport { endPoints, loginEndpoints } from './constants/endpoints';\nimport { BehaviorSubject, from, ReplaySubject, Subject, Subscription } from 'rxjs';\nimport * as moment from 'moment';\nimport { first, map } from 'rxjs/operators';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../utility/utility.service\";\nimport * as i2 from \"../base/base-factory-provider\";\nimport * as i3 from \"../access/access.service\";\nimport * as i4 from \"@mobile/app/modules/shared/service/in-app-browser/in-app-browser.service\";\nimport * as i5 from \"../mx-service/mx.service\";\nimport * as i6 from \"@ionic/angular\";\nimport * as i7 from \"@mobile/app/modules/shared/service/authentication/authentication.service\";\nexport const SESSION_TIMEOUT_DURATION = 14 * 60 * 1000;\nexport let AccountService = /*#__PURE__*/(() => {\n  class AccountService {\n    constructor(utilityService, baseService, accessService, inAppBrowserService, mxService, loadingController, authService) {\n      this.utilityService = utilityService;\n      this.baseService = baseService;\n      this.accessService = accessService;\n      this.inAppBrowserService = inAppBrowserService;\n      this.mxService = mxService;\n      this.loadingController = loadingController;\n      this.authService = authService;\n      this.endPoints = endPoints;\n      this.predictiveMessage = null;\n      this.predictiveMessage$ = null;\n      this.participantData = null;\n      this.participantSubject = null;\n      this.subscription = new Subscription();\n      this.externalLinksData = null;\n      this.externalLinksSubject = null;\n      this.selectedTab$ = new Subject();\n      this.allAccountData = null;\n      this.allAccountSubject = null;\n      this.aggregatedAccountDataSubject = null;\n      this.accountsContent$ = null;\n      this.sort = new BehaviorSubject('');\n      this.filt = new BehaviorSubject([]);\n      this.balanceHistoryGraphData = null;\n      this.balanceHistoryGraphSubject = null;\n      this.storedFilterKey = [];\n      this.storedSortKey = '';\n      this.today = new Date();\n      this.priorDate = moment(new Date().setDate(this.today.getDate() - 90)).format('YYYY/MM/DD');\n      this.currentDate = moment(Date.now()).format('YYYY/MM/DD');\n      this.endPoints = this.utilityService.appendBaseUrlToEndpoints(endPoints);\n      this.environment = this.utilityService.getEnvironment();\n      this.loginEndpoints = this.utilityService.appendBaseUrlToEndpoints(loginEndpoints, this.environment.loginBaseUrl);\n      this.participantSubject = new ReplaySubject(1);\n      this.balanceHistoryGraphSubject = new ReplaySubject(1);\n      this.externalLinksSubject = new ReplaySubject(1);\n      this.allAccountSubject = new ReplaySubject(1);\n      this.aggregatedAccountDataSubject = new ReplaySubject(1);\n      this.account = JSON.parse(localStorage.getItem('currentAccount'));\n      this.isWeb = this.utilityService.getIsWeb();\n      this.predictiveMessage$ = new ReplaySubject(1);\n      this.accountsContent$ = new ReplaySubject(1);\n    }\n\n    getJSON(refresh = false) {\n      return __awaiter(this, void 0, void 0, function* () {\n        if (!this.accountInfo || refresh) {\n          const sessionID = yield this.accessService.getSessionId();\n          const accountsData = yield this.baseService.get(this.endPoints.allAccounts + sessionID);\n          accountsData.hsaAccounts = yield this.getHSAAccounts();\n          this.accountInfo = accountsData;\n        }\n\n        return this.accountInfo;\n      });\n    }\n\n    getHSAorFSA() {\n      return __awaiter(this, void 0, void 0, function* () {\n        if (!this.hasHSAorFSA) {\n          const accounts = {\n            hsa: false,\n            fsa: false\n          };\n          const accData = yield this.getJSON();\n          accData.hsaAccounts.accounts.forEach(acc => {\n            if (acc.hsaAccountData.Plan_Type == 'HSA') {\n              accounts.hsa = true;\n            } else if (acc.hsaAccountData.Plan_Type == 'MedicalFlex') {\n              accounts.fsa = true;\n            }\n          });\n          const mxAccs = yield this.mxService.getMxAccountConnect().pipe(first()).toPromise();\n          mxAccs.accounts.forEach(acc => {\n            if (acc.account_type_name === 'Savings' && acc.account_subtype_name === 'HEALTH') {\n              accounts.hsa = true;\n            }\n          });\n          this.hasHSAorFSA = accounts;\n        }\n\n        return this.hasHSAorFSA;\n      });\n    }\n\n    constructAggregatedAccounts() {\n      return __awaiter(this, void 0, void 0, function* () {\n        const sessionID = yield this.accessService.getSessionId();\n        return this.baseService.get(`${this.endPoints.aggregatedAccounts + sessionID}`);\n      });\n    }\n\n    getAggregatedAccounts(refresh = false) {\n      if (!this.aggregatedAcctData || refresh) {\n        this.aggregatedAcctData = from(this.constructAggregatedAccounts());\n        const subscription = this.aggregatedAcctData.subscribe(result => {\n          this.aggregatedAccountDataSubject.next(result);\n        });\n        this.subscription.add(subscription);\n      }\n\n      return this.aggregatedAccountDataSubject;\n    }\n\n    getExternalLinks(refresh = false) {\n      if (!this.externalLinksData || refresh) {\n        this.accessService.checkMyvoyageAccess().then(res => __awaiter(this, void 0, void 0, function* () {\n          const domain = res.clientDomain;\n          const clientId = res.clientId;\n          const sessionID = yield this.accessService.getSessionId();\n          const url = this.endPoints.externalLinks.replace('{planID}', this.account.planId).replace('{client}', clientId).replace('{sessionID}', sessionID).replace('{domain}', domain);\n          this.externalLinksData = from(this.baseService.get(url));\n          const subscription = this.externalLinksData.subscribe(result => {\n            this.externalLinksSubject.next(result);\n          });\n          this.subscription.add(subscription);\n        }));\n      }\n\n      return this.externalLinksSubject;\n    }\n\n    getVestedBalance() {\n      return __awaiter(this, void 0, void 0, function* () {\n        return this.baseService.get(this.endPoints.vestedBalance + this.account.clientId + '/' + this.account.planId);\n      });\n    }\n\n    getGainLoss() {\n      return __awaiter(this, void 0, void 0, function* () {\n        return this.baseService.get(this.endPoints.gainLoss + this.account.clientId + '/' + this.account.planId);\n      });\n    }\n\n    getLoan() {\n      return __awaiter(this, void 0, void 0, function* () {\n        return this.baseService.get(this.endPoints.loan + this.account.clientId + '/' + this.account.planId);\n      });\n    }\n\n    getRateOfReturn() {\n      return __awaiter(this, void 0, void 0, function* () {\n        return this.baseService.get(this.endPoints.rateOfReturn + this.account.clientId + '/' + this.account.planId);\n      });\n    }\n\n    getPlanAdviceStatuses() {\n      return __awaiter(this, void 0, void 0, function* () {\n        return this.baseService.get(this.endPoints.planAdviceStatus);\n      });\n    }\n\n    getDividends() {\n      return this.baseService.get(this.endPoints.dividend + this.account.clientId + '/' + this.account.planId);\n    }\n\n    getContribution() {\n      return __awaiter(this, void 0, void 0, function* () {\n        return this.baseService.get(this.endPoints.contribution + this.account.clientId + '/' + this.account.planId);\n      });\n    }\n\n    getYTDContribution() {\n      return __awaiter(this, void 0, void 0, function* () {\n        return this.baseService.get(this.endPoints.ytdcontribution + this.account.clientId + '/' + this.account.planId);\n      });\n    }\n\n    getEmployersMatch() {\n      return __awaiter(this, void 0, void 0, function* () {\n        return this.baseService.get(this.endPoints.employersmatch + this.account.clientId + '/' + this.account.planId);\n      });\n    }\n\n    getTransaction() {\n      return __awaiter(this, void 0, void 0, function* () {\n        if (this.account.isHSAAccount) {\n          return this.getHSATransactions();\n        } else {\n          return this.baseService.get(this.endPoints.transaction + this.account.clientId + '/' + this.account.planId + '?tranType=ALL&startDate=' + this.priorDate + '&endDate=' + this.currentDate);\n        }\n      });\n    }\n\n    getAccount() {\n      if (!this.account) {\n        this.account = JSON.parse(localStorage.getItem('currentAccount'));\n      }\n\n      return this.account;\n    }\n\n    setAccount(account) {\n      localStorage.setItem('currentAccount', JSON.stringify(account));\n      this.account = account;\n    }\n\n    getParticipant(refresh = false) {\n      if (!this.participantData || refresh) {\n        this.participantData = from(this.baseService.get(this.endPoints.participantData));\n        const subscription = this.participantData.subscribe(result => {\n          this.participantSubject.next(result);\n        });\n        this.subscription.add(subscription);\n      }\n\n      return this.participantSubject;\n    }\n\n    setParticipant(participant) {\n      this.participantSubject.next(participant);\n    }\n\n    getOffercode() {\n      return __awaiter(this, void 0, void 0, function* () {\n        if (!this.offercodes) {\n          const sessionID = yield this.accessService.getSessionId();\n          this.offercodes = yield this.baseService.get(this.endPoints.getOfferCode + sessionID);\n        }\n\n        return this.offercodes;\n      });\n    }\n\n    getPredict() {\n      return __awaiter(this, void 0, void 0, function* () {\n        return new Promise(resolve => {\n          this.subscription.add(this.fetchPredictiveMessage().subscribe(response => {\n            resolve(response.OfferCodeAdviceJSON ? JSON.parse(response.OfferCodeAdviceJSON) : null);\n          }));\n        });\n      });\n    }\n\n    getCarouselData() {\n      return __awaiter(this, void 0, void 0, function* () {\n        return new Promise(resolve => {\n          this.subscription.add(this.fetchPredictiveMessage().subscribe(response => {\n            resolve(response.OfferCodeJSON ? JSON.parse(response.OfferCodeJSON) : null);\n          }));\n        });\n      });\n    }\n\n    fetchBalanceHistoryGraph() {\n      if (!this.balanceHistoryGraphData) {\n        this.balanceHistoryGraphData = from(this.baseService.get(this.endPoints.balancehistory));\n        const subscription = this.balanceHistoryGraphData.subscribe(result => {\n          this.balanceHistoryGraphSubject.next(result);\n        });\n        this.subscription.add(subscription);\n      }\n\n      return this.balanceHistoryGraphSubject;\n    }\n\n    fetchPredictiveMessage(refresh = false) {\n      if (!this.predictiveMessage || refresh) {\n        this.predictiveMessage = from(this.baseService.get(this.endPoints.predictiveMessage));\n        const subscription = this.predictiveMessage.subscribe(data => {\n          this.predictiveMessage$.next(data);\n        }, error => {\n          console.log(error);\n          this.predictiveMessage$.next({});\n        });\n        this.subscription.add(subscription);\n      }\n\n      return this.predictiveMessage$;\n    }\n\n    posNegSymbol(val) {\n      if (val && +val) {\n        return val < 0 ? '' : '+';\n      }\n\n      return '';\n    }\n\n    getSelectedTab$() {\n      return this.selectedTab$;\n    }\n\n    publishSelectedTab(selectedTab) {\n      this.selectedTab$.next(selectedTab);\n    }\n\n    getAllAccounts(refresh = false) {\n      if (!this.allAccountData || refresh) {\n        this.allAccountData = from(this.getJSON());\n        const allAccountSubscription = this.allAccountData.subscribe(data => {\n          this.allAccountSubject.next(data);\n        });\n        this.subscription.add(allAccountSubscription);\n      }\n\n      return this.allAccountSubject;\n    }\n\n    getAccountDataBasedOnType(planId, type, refresh = false) {\n      return this.getAllAccounts(refresh).pipe(map(data => data[type].accounts.filter(account => account.planId === planId && !account.isVoyaAccessPlan)[0]));\n    }\n\n    getAccountDataWithoutType(planId, refresh = false) {\n      return this.getAllAccounts(refresh).pipe(map(data => data['retirementAccounts'].accounts.filter(account => account.planId === planId && !account.isVoyaAccessPlan)[0] || data['stockAccounts'].accounts.filter(account => account.planId === planId && !account.isVoyaAccessPlan)[0] || data['vendorAccounts'].accounts.filter(account => account.planId === planId && !account.isVoyaAccessPlan)[0] || data['brokerageAccounts'].accounts.filter(account => account.planId === planId && !account.isVoyaAccessPlan)[0] || data['hsaAccounts'].accounts.filter(account => account.planId === planId && !account.isVoyaAccessPlan)[0]));\n    }\n\n    filterIsVoyaAccessPlanAccountData(data, type, planId, agreementId) {\n      return data[type].accounts.filter(account => account.planId === planId && account.agreementId === agreementId && account.isVoyaAccessPlan)[0];\n    }\n\n    getIsVoyaAccessPlanAccountData(planId, agreementId, refresh = false) {\n      return this.getAllAccounts(refresh).pipe(map(data => this.filterIsVoyaAccessPlanAccountData(data, 'retirementAccounts', planId, agreementId) || this.filterIsVoyaAccessPlanAccountData(data, 'stockAccounts', planId, agreementId) || this.filterIsVoyaAccessPlanAccountData(data, 'vendorAccounts', planId, agreementId) || this.filterIsVoyaAccessPlanAccountData(data, 'hsaAccounts', planId, agreementId)));\n    }\n\n    openPwebAccountLink(link, target) {\n      return __awaiter(this, void 0, void 0, function* () {\n        if (this.utilityService.getIsWeb()) {\n          window.open(link, target || '_blank');\n        } else {\n          const loading = yield this.loadingController.create({\n            translucent: true\n          });\n          yield loading.present();\n          const authToken = yield this.authService.getAccessToken();\n          const request = {\n            client_id: this.environment.authTokenExchangeClient,\n            subject_token: authToken,\n            subject_token_type: 'access_token',\n            audience: this.loginEndpoints.samlAudience,\n            grant_type: 'urn:ietf:params:oauth:grant-type:token-exchange',\n            requested_token_type: 'access_token',\n            scope: 'urn:voya:federation'\n          };\n          const queryAuthTokenResponse = yield this.baseService.postUrlEncoded(this.environment.tokenBaseUrl + 'oidcop/sps/oauth/oauth20/token', request, {});\n          loading.dismiss();\n          const url = this.encodePwebAccountLink(link, queryAuthTokenResponse.access_token);\n          this.inAppBrowserService.openSystemBrowser(url);\n        }\n      });\n    }\n\n    encodePwebAccountLink(link, access_token) {\n      return this.loginEndpoints.authService.replace('[exchanged_access_token]', access_token) + encodeURIComponent(link);\n    }\n\n    openInAppBrowser(link) {\n      this.inAppBrowserService.openSystemBrowser(link);\n    }\n\n    transformHSAAccount(hsa) {\n      let totalBal = hsa.CashBalance;\n\n      if (hsa.Plan_Type === 'HSA') {\n        totalBal = hsa.TotalBalance;\n      }\n\n      const acc = {\n        accountTitle: hsa.Plan_Name,\n        accountBalance: totalBal.toString(),\n        accountBalanceAsOf: hsa.AsOfDate,\n        sourceSystem: '',\n        suppressTab: false,\n        voyaSavings: '',\n        includedInOrangeMoney: false,\n        accountAllowedForMyVoya: false,\n        clientId: '',\n        planId: hsa.Plan_ID.toString(),\n        planType: hsa.Plan_Type,\n        accountNumber: '',\n        needOMAutomaticUpdate: false,\n        planName: hsa.Plan_Name,\n        mpStatus: '',\n        clientAllowed4myVoyaOrSSO: false,\n        useMyvoyaHomepage: false,\n        advisorNonMoneyTxnAllowed: false,\n        advisorMoneyTxnAllowed: false,\n        nqPenCalPlan: false,\n        enrollmentAllowed: false,\n        autoEnrollmentAllowed: false,\n        vruPhoneNumber: '',\n        rmdRecurringPaymentInd: '',\n        navigateToRSPortfolio: false,\n        planLink: '',\n        openDetailInNewWindow: false,\n        nqPlan: false,\n        new: false,\n        eligibleForOrangeMoney: false,\n        iraplan: false,\n        xsellRestricted: false,\n        isVoyaAccessPlan: false,\n        isRestrictedRetirementPlan: false,\n        isVDAApplication: false,\n        isVendorPlan: false,\n        isHSAAccount: true,\n        hsaAccountData: hsa\n      };\n      return acc;\n    }\n\n    getHSAAccounts() {\n      var _a;\n\n      return __awaiter(this, void 0, void 0, function* () {\n        const sessionID = yield this.accessService.getSessionId();\n        const result = yield this.baseService.get(this.endPoints.allHSAAccounts + sessionID);\n\n        if (!result) {\n          return {\n            dataStatus: 'failed',\n            errorCode: '',\n            accounts: []\n          };\n        }\n\n        const resultArr = [];\n        (_a = result === null || result === void 0 ? void 0 : result.AllAccountsBalance) === null || _a === void 0 ? void 0 : _a.forEach(element => {\n          resultArr.push(this.transformHSAAccount(element));\n        });\n        return {\n          dataStatus: result.Status,\n          errorCode: '',\n          accounts: resultArr\n        };\n      });\n    }\n\n    transformHSATransaction(hsaTransaction) {\n      return {\n        tradeDate: hsaTransaction.Transaction_Date,\n        type: '',\n        tranCode: hsaTransaction.Transaction_Code,\n        cash: hsaTransaction.Transaction_Amt,\n        clientId: '',\n        planId: hsaTransaction.Plan_ID.toString(),\n        participantId: '',\n        unit_or_unshrs: '',\n        br140_new_val_cash: '',\n        br161_shr_price: '',\n        br009_run_date: '',\n        br011_seq_num: '',\n        br980_ACT_NAME: hsaTransaction.Transaction_Description,\n        br172_vouch_num: '',\n        isHSATransaction: true,\n        hsaTransactionData: hsaTransaction\n      };\n    }\n\n    getHSATransactions() {\n      var _a, _b;\n\n      return __awaiter(this, void 0, void 0, function* () {\n        const hasPartyID = (_a = this.account.hsaAccountData) === null || _a === void 0 ? void 0 : _a.HAS_PARTY_ID;\n        const planId = (_b = this.account.hsaAccountData) === null || _b === void 0 ? void 0 : _b.Plan_ID;\n        const url = this.endPoints.hsaTransactions + hasPartyID + '/' + planId;\n        const result = yield this.baseService.get(url);\n        const resultArr = [];\n        result.AllAccountsTransactions.forEach(element => {\n          resultArr.push(this.transformHSATransaction(element));\n        });\n        return {\n          transactionHistories: resultArr\n        };\n      });\n    }\n\n    getDisplayNameOrFirst(participant) {\n      if (participant.displayName && participant.displayName.length > 0 && participant.displayName.toLocaleLowerCase() != participant.lastName.toLocaleLowerCase() + ', ' + participant.firstName.toLocaleLowerCase()) {\n        return participant.displayName;\n      }\n\n      return participant.firstName;\n    }\n\n    getDisplayNameOrFirstOrLast(participant) {\n      const displayName = participant.displayName ? participant.displayName : '';\n      const firstName = participant.firstName ? participant.firstName : '';\n      const lastName = participant.lastName ? participant.lastName : '';\n\n      if (displayName.length > 0 && (displayName.includes(',') && displayName.toLocaleLowerCase() != firstName.toLocaleLowerCase() + ', ' + lastName.toLocaleLowerCase() || !displayName.includes(',') && displayName.toLocaleLowerCase() != firstName.toLocaleLowerCase() + ' ' + lastName.toLocaleLowerCase())) {\n        return displayName;\n      } else if (firstName.length > 0) {\n        return firstName;\n      } else {\n        return lastName;\n      }\n    }\n\n    getDisplayNameOrFirstLast(participant) {\n      const displayName = participant.displayName ? participant.displayName : '';\n      const firstName = participant.firstName ? participant.firstName : '';\n      const lastName = participant.lastName ? participant.lastName : '';\n\n      if (displayName.length > 0 && displayName.toLocaleLowerCase() != firstName.toLocaleLowerCase() + ', ' + lastName.toLocaleLowerCase()) {\n        return displayName;\n      } else {\n        return firstName + ' ' + lastName;\n      }\n    }\n\n    changeSort(data) {\n      this.sort.next(data);\n    }\n\n    currentSort() {\n      return this.sort.asObservable();\n    }\n\n    getAddAcctModalContent() {\n      return __awaiter(this, void 0, void 0, function* () {\n        return new Promise(resolve => {\n          this.subscription.add(this.fetchAccountsContent().subscribe(response => {\n            resolve(response.WorkplaceAddAccountsModalJSON ? JSON.parse(response.WorkplaceAddAccountsModalJSON) : null);\n          }));\n        });\n      });\n    }\n\n    getSectionValues() {\n      return __awaiter(this, void 0, void 0, function* () {\n        return new Promise(resolve => {\n          this.subscription.add(this.fetchAccountsContent().subscribe(response => {\n            resolve(response.HSA_Transaction_FilterSort_SelectionList ? JSON.parse(response.HSA_Transaction_FilterSort_SelectionList) : null);\n          }));\n        });\n      });\n    }\n\n    fetchAccountsContent(refresh = false) {\n      if (!this.accountsContent || refresh) {\n        this.accountsContent = from(this.baseService.get(this.endPoints.accountsContent));\n        const subscription = this.accountsContent.subscribe(data => {\n          this.accountsContent$.next(data);\n        }, error => {\n          console.log(error);\n          this.accountsContent$.next({});\n        });\n        this.subscription.add(subscription);\n      }\n\n      return this.accountsContent$;\n    }\n\n    changeFilt(data) {\n      this.filt.next(data);\n    }\n\n    setFiltSlcted(keyName) {\n      this.storedFilterKey = keyName;\n      localStorage.setItem('storedFilterKey', JSON.stringify(keyName));\n    }\n\n    getFiltSlcted() {\n      if (!this.storedFilterKey) {\n        this.storedFilterKey = JSON.parse(localStorage.getItem('storedFilterKey'));\n      }\n\n      return this.storedFilterKey;\n    }\n\n    currentFilter() {\n      return this.filt.asObservable();\n    }\n\n    setSortSlcted(keyName) {\n      this.storedSortKey = keyName;\n      localStorage.setItem('storedSortKey', JSON.stringify(keyName));\n    }\n\n    getSortSlcted() {\n      if (!this.storedSortKey) {\n        this.storedSortKey = JSON.parse(localStorage.getItem('storedSortKey'));\n      }\n\n      return this.storedSortKey;\n    }\n\n    ngOnDestroy() {\n      this.subscription.unsubscribe();\n    }\n\n  }\n\n  AccountService.ɵfac = function AccountService_Factory(t) {\n    return new (t || AccountService)(i0.ɵɵinject(i1.SharedUtilityService), i0.ɵɵinject(i2.BaseService), i0.ɵɵinject(i3.AccessService), i0.ɵɵinject(i4.InAppBroserService), i0.ɵɵinject(i5.MXService), i0.ɵɵinject(i6.LoadingController), i0.ɵɵinject(i7.AuthenticationService));\n  };\n\n  AccountService.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n    token: AccountService,\n    factory: AccountService.ɵfac,\n    providedIn: 'root'\n  });\n  return AccountService;\n})();","map":null,"metadata":{},"sourceType":"module"}